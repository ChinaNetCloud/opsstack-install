- hosts: localhost
  connection: local
  tasks:
    - name: Verify extra-vars
      fail: msg="Hostname for Opsstack config is not defined"
      when: opsstack_hostname is not defined

    - name: Save SELinux settings
      set_fact: selinux="{{ ansible_selinux }}"
      when: ansible_selinux and ansible_selinux.status != "disabled"

    - name: Disable SElinux
      selinux: state=disabled
      when: selinux is defined

    - include: ./base_monitoring/rhel6.yml
      when: (ansible_os_family == "RedHat" and ansible_distribution_major_version|int == 6) or ansible_distribution == 'Amazon'

    - include: ./base_monitoring/rhel7.yml
      when: ansible_os_family == "RedHat" and ansible_distribution_major_version|int == 7

    - include: ./base_monitoring/debian8.yml
      when: ansible_distribution == "Debian" and ansible_distribution_major_version|int == 8

    - include: ./base_monitoring/debian7.yml
      when: ansible_distribution == "Debian" and ansible_distribution_major_version|int == 7

    - include: ./base_monitoring/ubuntu1204.yml
      when: ansible_distribution == "Ubuntu" and ansible_distribution_major_version|int == 12

    - include: ./base_monitoring/ubuntu1404.yml
      when: ansible_distribution == "Ubuntu" and ansible_distribution_major_version|int == 14

    - include: ./base_monitoring/ubuntu1604.yml
      when: ansible_distribution == "Ubuntu" and ansible_distribution_major_version|int == 16

    - name: Enable SElinux
      selinux: state="{{ selinux.config_mode }}" policy="{{ selinux.type }}"
      when: selinux is defined
